<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Barber - Mistral</title>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { 
            background-color: #121212; 
            color: white; 
            font-family: 'Heebo', sans-serif; 
            text-align: center; 
            margin: 0; 
            padding: 20px; 
        }

        .camera-label {
            background: #d4af37; 
            color: #000;
            font-weight: bold;
            font-size: 20px;
            padding: 20px;
            display: block;
            width: 100%;
            border-radius: 12px;
            margin: 20px 0;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
        }

        input[type="file"] { display: none; }

        .gallery {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .gallery img {
            width: 80px; height: 80px;
            border-radius: 10px;
            object-fit: cover;
            border: 2px solid #d4af37;
        }

        textarea {
            width: 100%;
            background: #222;
            color: white;
            border: 1px solid #444;
            padding: 10px;
            font-size: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .analyze-btn {
            background: #444; color: #888;
            padding: 15px; width: 100%;
            border: none; border-radius: 12px;
            font-size: 18px; font-weight: bold;
        }
        
        .analyze-btn.active {
            background: #f55036; color: white; cursor: pointer;
        }

        #results {
            margin-top: 30px;
            text-align: right;
            background: #1e1e1e;
            padding: 15px;
            border-radius: 10px;
            display: none;
            line-height: 1.6;
            border: 1px solid #333;
        }
    </style>
</head>
<body>

    <h1>ğŸ’ˆ AI Barber</h1>
    <p>×’×¨×¡×ª ××™×¡×˜×¨×œ (Mistral)</p>

    <div class="gallery" id="gallery"></div>

    <label class="camera-label" id="cameraBtn">
        ğŸ“· ×œ×—×¥ ×›××Ÿ ×œ×¦×™×œ×•×
        <input type="file" accept="image/*" capture="environment" onchange="handleFile(this)">
    </label>

    <textarea id="notes" rows="3" placeholder="×”×¢×¨×•×ª ×œ-AI (×œ××©×œ: ×©×™×¢×¨ ×“×œ×™×œ...)"></textarea>

    <button class="analyze-btn" id="analyzeBtn" onclick="analyze()" disabled>
        ×××ª×™×Ÿ ×œ×ª××•× ×•×ª...
    </button>

    <div id="results"></div>

<script>
    let photos = [];

    function handleFile(input) {
        if (photos.length >= 3) {
            alert("×›×‘×¨ ×™×© 3 ×ª××•× ×•×ª.");
            return;
        }
        const file = input.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            photos.push(e.target.result);
            const img = document.createElement('img');
            img.src = e.target.result;
            document.getElementById('gallery').appendChild(img);
            input.value = ""; 
            updateButton();
        }
        reader.readAsDataURL(file);
    }

    function updateButton() {
        const btn = document.getElementById('cameraBtn');
        btn.innerHTML = `ğŸ“· ×¦×œ× ×ª××•× ×” (${photos.length}/3)
        <input type="file" accept="image/*" capture="environment" onchange="handleFile(this)">`;
        
        const analyzeBtn = document.getElementById('analyzeBtn');
        if (photos.length >= 3) {
            analyzeBtn.disabled = false;
            analyzeBtn.classList.add('active');
            analyzeBtn.innerText = "âš¡ × ×ª×— ×©×™×¢×¨ ×¢× Mistral";
            document.getElementById('cameraBtn').style.display = 'none';
        }
    }

    async function analyze() {
        // ============================================
        // ğŸ‘‡ğŸ‘‡ğŸ‘‡ ×©×™× ×¤×” ××ª ×”××¤×ª×— ×©×œ Mistral ğŸ‘‡ğŸ‘‡ğŸ‘‡
        // ============================================
        
        const API_KEY = "nc1LwJB1EDo63VdOunE1HcGOBWpfOHtr";
        
        // ğŸ‘†ğŸ‘†ğŸ‘† ×œ× ×œ××—×•×§ ×’×¨×©×™×™× ×•× ×§×•×“×” ×¤×¡×™×§ ğŸ‘†ğŸ‘†ğŸ‘†
        // ============================================

        if (API_KEY.includes("×”×“×‘×§_×›××Ÿ")) {
            alert("×œ× ×©××ª ××ª ×”××¤×ª×— ×©×œ Mistral!"); return;
        }

        document.getElementById('analyzeBtn').innerText = "Mistral ×—×•×©×‘...";
        document.getElementById('results').style.display = 'block';
        document.getElementById('results').innerText = "×©×•×œ×— ×œ××™×¡×˜×¨×œ...";

        const notes = document.getElementById('notes').value;
        const promptText = `
        Act as a professional barber. Analyze these user photos. 
        User notes: ${notes}.
        OUTPUT IN HEBREW ONLY.
        Format:
        1. Face Shape Analysis.
        2. 3 Recommended Haircuts.
        `;

        // ×”×›× ×ª ×”×ª××•× ×•×ª ×‘×¤×•×¨××˜ ×©×œ Mistral
        const content = [{ type: "text", text: promptText }];
        photos.forEach(p => content.push({ type: "image_url", image_url: p }));

        try {
            const res = await fetch("https://api.mistral.ai/v1/chat/completions", {
                method: "POST",
                headers: { 
                    "Content-Type": "application/json", 
                    "Authorization": `Bearer ${API_KEY}` 
                },
                body: JSON.stringify({ 
                    model: "pixtral-12b-2409", // ×”××•×“×œ ×”××™×•×—×“ ×œ×ª××•× ×•×ª ×©×œ ××™×¡×˜×¨×œ
                    messages: [{ role: "user", content: content }],
                    max_tokens: 1000
                })
            });
            
            const data = await res.json();
            
            if (data.error) throw new Error(data.error.message);
            if (!data.choices || data.choices.length === 0) throw new Error("No response");

            let text = data.choices[0].message.content;
            
            // ×¢×™×¦×•×‘
            text = text.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
            text = text.replace(/\n/g, '<br>');
            
            document.getElementById('results').innerHTML = text;
            
        } catch (e) {
            document.getElementById('results').innerText = "×©×’×™××”: " + e.message;
        } finally {
             document.getElementById('analyzeBtn').innerText = "âš¡ × ×ª×— ×©×•×‘";
        }
    }
</script>
</body>
</html>
